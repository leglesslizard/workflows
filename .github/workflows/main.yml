on: 
  push:
    branches:
      - main

jobs:
  release-on-push:
    runs-on: ubuntu-latest
    env:
      GITHUB_TOKEN: ${{ secrets.GITHUB_TOKEN }}
    steps:
      - id: prerelease
        uses: rymndhng/release-on-push-action@master
        name: Check if we are running a new release
        with:
          tag_prefix: ""
          bump_version_scheme: norelease
          dry_run: true

      - name: Check out the repo
        if: steps.prerelease.outputs.version
        uses: actions/checkout@v3

      - name: Bump the version numbers
        if: steps.prerelease.outputs.version
        run: |
          echo "Creating release version ${{ steps.prerelease.outputs.version }}"
          git checkout
          sed -i "s/version\":\ \"[0-9]\+\.\?[0-9]*\.\?[0-9]*/version\":\ \"${{ steps.prerelease.outputs.version }}/g" ./defo.txt
          sed -i "s/Version:\ [0-9]\+\.\?[0-9]*\.\?[0-9]*/Version:\ ${{ steps.prerelease.outputs.version }}/g" ./pie.txt
          git config user.name "Github Actions"
          git config user.email "<>"
          git add .
          git commit --amend --no-edit
          git push -f
      - uses: rymndhng/release-on-push-action@master
        name: Create the release
        if: steps.prerelease.outputs.version
        with:
          tag_prefix: ""
          bump_version_scheme: norelease
          use_github_release_notes: true